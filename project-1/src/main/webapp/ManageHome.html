<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Employee Home</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- Font Awesome -->
<link
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
rel="stylesheet"
/>
<!-- Google Fonts -->
<link
href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
rel="stylesheet"
/>
<!-- MDB -->
<link
href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.css"
rel="stylesheet"
/>
</head>
<body>

	<!--header start-->

	<header>
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-light bg-white">
		  <div class="container-fluid">
			<button
			  class="navbar-toggler"
			  type="button"
			  data-mdb-toggle="collapse"
			  data-mdb-target="#navbarExample01"
			  aria-controls="navbarExample01"
			  aria-expanded="false"
			  aria-label="Toggle navigation"
			>
			  <i class="fas fa-bars"></i>
			</button>
			<div class="collapse navbar-collapse" id="navbarExample01">
			  <ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item active">
				  <a class="btn btn-warning nav-link" onclick="logout()">Logout</a>
				</li>
			   
			  </ul>
			</div>
		  </div>
		</nav>
		<!-- Navbar -->
	  
		<!-- Jumbotron -->
		<div class="p-5 text-center bg-light">
		  <h1 class="mb-3" id="welcome">You are Logged in</h1>	
		</div>
		<!-- Jumbotron -->
	  </header>

	<div class="container mt-4">

		<div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card">
                <img
                  src="https://img.icons8.com/color/240/000000/document--v2.png"
                  class="card-img-top"
                  alt="..."
                />
                <div class="card-body">
                  <button class="btn btn-outline-primary container" data-mdb-toggle="modal"
                  data-mdb-target="#pendingModal">View All Reimburement</button>
                  <p class="card-text">
                    View All Reimburement
                  </p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card">
                <img
                  src="https://img.icons8.com/color/240/000000/folder-invoices--v2.png"
                  class="card-img-top"
                  alt="..."
                />
                <div class="card-body">
                  <button class="btn btn-outline-primary container" data-mdb-toggle="modal"
                  data-mdb-target="#approveModal">Approve Tickets</button>
                  <p class="card-text">
                    Approve Reimburement Request
                  </p>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card">
                <img
                  src="https://img.icons8.com/dusk/256/000000/contacts.png"
                  class="card-img-top"
                  alt="..."
                />
                <div class="card-body">
                  <button class="btn btn-outline-primary container" data-mdb-toggle="modal"
                  data-mdb-target="#viewEmployeeModal">View All Employee</button>
                  <p class="card-text">
                    View All Employees
                  </p>
                </div>
              </div>
            </div>
            
          </div>

</div>


<!-- Modal -->
<div
  class="modal fade"
  id="viewEmployeeModal"
  tabindex="-1"
  aria-labelledby="viewEmployeeModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewEmployeeModalLabel">Employees</h5>
        <button
          type="button"
          class="btn-close"
          data-mdb-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <table class="table table-borderless">
            <thead>
                <tr>
                  <th>Id</th>
                  <th>Username</th>
                  <th>Password</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Email</th>
                  <th>Role ID</th>
                    
                </tr>
            </thead>
            <tbody id="useroutput">
               
            </tbody>
        </table>

      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="userbtn">Get Users</button>
      </div>

    </div>
  </div>
</div>

<!--modals-->

<div
  class="modal fade"
  id="approveModal"
  tabindex="-1"
  aria-labelledby="approveModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="approveModalLabel">Approve Pending Request</h5>
        <button
          type="button"
          class="btn-close"
          data-mdb-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form action="approveRequest" method="POST">
          <div class="input-group flex-nowrap mt-2">
              <span class="input-group-text" id="ID">ID</span>
              <input type="number" class="form-control" name="id" id="id" placeholder="Enter Reimbursement ID" required/>
            </div>

            <div class="input-group flex-nowrap mt-3">
              <span class="input-group-text" id="date_resolved">Date Resolved</span>
              <input type="date" class="form-control" name="date_resolved" id="date_resolved" placeholder="Enter Reimbursement ID" required/>
            </div>

            <div class="input-group flex-nowrap mt-3">
              <span class="input-group-text" id="date_resolved">Resolver</span>
              <input type="number" class="form-control" name="resolver" id="resolver" placeholder="Enter Manager id" required/>
            </div>

            <div class="input-group flex-nowrap mt-3 mb-3">
              <span class="input-group-text" id="status_id">Status</span>
              <select name="status_id" id="status_id" class="form-control">
                  <option value="1">Denied</option>
                  <option value="2">Approved</option>
              </select>
            </div>

          <input type="submit" value="Submit" class="btn btn-primary">
      </form>

      </div>
    </div>
  </div>
</div>

<!--Modals-->

<div
  class="modal fade"
  id="pendingModal"
  tabindex="-1"
  aria-labelledby="pendingModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <div class="input-group flex-nowrap mt-2">
          <span class="input-group-text" id="ID">View Pending Request</span>
        <input type="text" class="form-control " id="myInput" placeholder="Search By Username"/>
        </div>
        <button
          type="button"
          class="btn-close"
          data-mdb-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">

        <table class="table table-borderless">
            <thead>
                <tr>
                  <th>Id</th>
                  <th>Amount</th>
                  <th>Date Submited</th>
                  <th>Date Resolved</th>
                  <th>Description</th>
                  <th>Author</th>
                  <th>Resolver</th>
                  <th>Status</th>
                  <th>Type</th>
                  <th>Username</th>
    
                </tr>
            </thead>
            <tbody id="output">
               
            </tbody>
        </table>

    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" id="mybtn">Get Reimburement</button>
    </div>
      </div>
    </div>
  </div>

</div>

<!--modals-->

<div class="container-fluid mt-5">
	<footer class="bg-dark text-center text-white" style="position:absolute; bottom:0px; width:100%;">
  
		<!-- Copyright -->
		<div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
		  &copy;2020 Project-1:
		 
		</div>
		<!-- Copyright -->
	  </footer>
	</div>
	<script>

  
	// capture the welcome element and modofy it so that it says welcome + username
	let welcome = document.getElementById('welcome');
	

	// capture the userString by accessing the session.....
	let userString = sessionStorage.getItem('currentUser');
	// set up some logic....
	// IF the user is null....redirect them to the index.html page ("http://localhost:8080/EmployeeDBServlets/")
	if (userString === null) {
		window.location = "http://localhost:8080/EmployeeDBServlets/";
	} else {
		
		let currentUser = JSON.parse(userString); // parse the data that we se == to that attribute
		
		console.log(currentUser);
		
		if (currentUser != null) {
			
            welcome.innerHTML = "Welcome " + currentUser.firstName + " " + currentUser.lastName;

		}
	}

	function logout() {
		
		let xhr = new XMLHttpRequest();		
		xhr.open("POST", "http://localhost:8080/EmployeeDBServlets/logout");
		xhr.send();
		
		sessionStorage.removeItem('currentUser');
		window.location = "http://localhost:8080/EmployeeDBServlets/";
		
	}

	var reimb='';
	$('#mybtn').click(function () {

		$.getJSON('employees', function (data) {
			
			$("tbody#output > td").remove();
			
			$.each(data, function (key, value) {

				$("#output").append('<tr><td>' +value['id'] +"</td>"+
								   "<td>"+value['amount'] + "</td>"+
								   "<td>"+value['date_submit'] + "</td>"+
								   "<td>"+value['date_resolved'] + "</td>"+
								   "<td>"+value['desc'] + "</td>"+
								   "<td>"+value['author'] + "</td>"+
								   "<td>"+value['resolver'] + "</td>"+
                   "<td>"+value['statusId'] + "</td>"+
                   "<td>"+value['typeId'] + "</td>"+
                   "<td>"+value['username'] +
									'</td></tr>');
			});
		});
	});

    $(document).ready(function(){
      $("#myInput").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#output tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });
    });
</script>

<script>
    var user='';
    $('#userbtn').click(function () {

        $.getJSON('users', function (data) {
            
            $("tbody#useroutput > td").remove();
            
            $.each(data, function (key, value) {

                $("#useroutput").append("<tr><td>" +value['id'] +"</td>"+
                                   "<td>"+value['username'] + "</td>"+
                                   "<td>"+value['password'] + "</td>"+
                                   "<td>"+value['firstName'] + "</td>"+
                                   "<td>"+value['lastName'] + "</td>"+
                                   "<td>"+value['email'] + "</td>"+
                                   "<td>"+value['role_id'] + "</td></tr>");
            
            });
        });
    });
</script>
<script
type="text/javascript"
src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.js"
></script>
</body>
</html>